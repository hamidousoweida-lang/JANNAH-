<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="JANNAH HAMIDOU - Your Islamic Education Companion">
    <title>JANNAH HAMIDOU - Islamic Education App</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#10b981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JANNEH">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-green: #10b981;
            --dark-green: #047857;
            --light-green: #34d399;
            --black: #0f172a;
            --dark-gray: #1e293b;
            --gray: #64748b;
            --light-gray: #f1f5f9;
            --white: #ffffff;
            --gold: #f59e0b;
            --success: #22c55e;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--light-gray);
            color: var(--black);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--black) 0%, var(--dark-gray) 100%);
            color: var(--white);
            padding: 1.5rem 2rem;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--primary-green);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            max-width: 1400px;
            margin: 0 auto;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 50px;
            height: 50px;
            background: var(--primary-green);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: var(--shadow);
        }

        .app-title {
            font-size: 1.8rem;
            font-weight: 800;
            letter-spacing: 1px;
        }

        .hasanat-counter {
            background: var(--primary-green);
            padding: 0.75rem 1.5rem;
            border-radius: 25px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
        }

        .hasanat-count {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
        }

        .nav-tabs {
            background: var(--white);
            display: flex;
            overflow-x: auto;
            border-bottom: 2px solid var(--light-gray);
            box-shadow: var(--shadow);
            scrollbar-width: thin;
        }

        .nav-tabs::-webkit-scrollbar {
            height: 4px;
        }

        .nav-tabs::-webkit-scrollbar-track {
            background: var(--light-gray);
        }

        .nav-tabs::-webkit-scrollbar-thumb {
            background: var(--primary-green);
            border-radius: 4px;
        }

        .nav-tab {
            flex: 1;
            min-width: 100px;
            padding: 1rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--gray);
            transition: all 0.2s ease;
            position: relative;
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
        }

        .nav-tab-icon {
            font-size: 1.4rem;
        }

        .nav-tab:hover {
            background: var(--light-gray);
            color: var(--primary-green);
        }

        .nav-tab.active {
            color: var(--primary-green);
            font-weight: 600;
            background: var(--light-gray);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-green);
        }

        .content-area {
            padding: 2rem;
            min-height: calc(100vh - 200px);
            max-width: 1400px;
            margin: 0 auto;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: var(--white);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-icon {
            font-size: 1.8rem;
        }

        .test-panel {
            background: linear-gradient(135deg, var(--dark-green), var(--primary-green));
            color: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .test-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            font-size: 0.95rem;
        }

        .test-status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
        }

        .test-status.success {
            background: var(--success);
        }

        .test-status.pending {
            background: var(--gold);
        }

        .quran-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .quran-select {
            flex: 1;
            min-width: 200px;
            padding: 0.875rem 1rem;
            border: 2px solid var(--light-gray);
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            background: var(--white);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quran-select:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .quran-verse {
            background: var(--white);
            border-left: 4px solid var(--primary-green);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .arabic-text {
            font-family: 'Amiri', serif;
            font-size: 1.8rem;
            line-height: 2.5;
            color: var(--black);
            text-align: right;
            direction: rtl;
            margin-bottom: 1rem;
        }

        .transliteration {
            font-style: italic;
            color: var(--gray);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .translation {
            color: var(--dark-gray);
            line-height: 1.8;
            font-size: 1.05rem;
        }

        .verse-number {
            display: inline-block;
            background: var(--primary-green);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .daily-verse-card {
            background: linear-gradient(135deg, var(--black), var(--dark-gray));
            color: var(--white);
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            text-align: center;
            margin-bottom: 2rem;
            border: 2px solid var(--primary-green);
        }

        .daily-verse-card .arabic-text {
            color: var(--white);
            font-size: 2rem;
        }

        .daily-verse-card .translation {
            color: rgba(255, 255, 255, 0.95);
            margin-top: 1.5rem;
            font-size: 1.1rem;
        }

        .hadith-item {
            background: var(--white);
            border-left: 4px solid var(--gold);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .hadith-arabic {
            font-family: 'Amiri', serif;
            font-size: 1.3rem;
            color: var(--black);
            text-align: right;
            direction: rtl;
            margin-bottom: 1rem;
            line-height: 2;
        }

        .hadith-translation {
            color: var(--dark-gray);
            line-height: 1.8;
            margin-bottom: 0.75rem;
        }

        .hadith-reference {
            color: var(--gray);
            font-size: 0.875rem;
            font-style: italic;
        }

        .btn {
            padding: 0.875rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--primary-green);
            color: var(--white);
            box-shadow: var(--shadow);
        }

        .btn-primary:hover {
            background: var(--dark-green);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .story-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .story-card {
            background: var(--white);
            border-radius: 8px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            box-shadow: var(--shadow);
        }

        .story-card:hover {
            border-color: var(--primary-green);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .story-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--black);
            margin-bottom: 0.5rem;
        }

        .story-preview {
            color: var(--gray);
            line-height: 1.6;
        }

        .prayer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .prayer-item {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid var(--light-gray);
            box-shadow: var(--shadow);
        }

        .prayer-item:hover {
            border-color: var(--primary-green);
            transform: scale(1.05);
        }

        .prayer-item.completed {
            background: var(--primary-green);
            color: var(--white);
            border-color: var(--dark-green);
        }

        .prayer-name {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .prayer-time {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .prayer-item.completed .prayer-time {
            color: rgba(255, 255, 255, 0.9);
        }

        .dua-item {
            background: var(--white);
            border-left: 4px solid var(--primary-green);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .dua-arabic {
            font-family: 'Amiri', serif;
            font-size: 1.5rem;
            color: var(--black);
            text-align: right;
            direction: rtl;
            margin-bottom: 1rem;
            line-height: 2.2;
        }

        .dua-transliteration {
            font-style: italic;
            color: var(--gray);
            margin-bottom: 0.75rem;
        }

        .dua-translation {
            color: var(--dark-gray);
            line-height: 1.8;
        }

        .quote-card {
            background: linear-gradient(135deg, var(--gold), #ea580c);
            color: var(--white);
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .quote-text {
            font-size: 1.2rem;
            font-style: italic;
            line-height: 1.8;
            margin-bottom: 1rem;
        }

        .quote-author {
            font-size: 0.95rem;
            opacity: 0.9;
            font-weight: 600;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        .spinner {
            border: 3px solid var(--light-gray);
            border-top: 3px solid var(--primary-green);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--primary-green);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
            }

            .app-title {
                font-size: 1.5rem;
            }

            .content-area {
                padding: 1rem;
            }

            .nav-tab {
                min-width: 80px;
                font-size: 0.75rem;
                padding: 0.75rem 0.5rem;
            }

            .story-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">üïå</div>
                <h1 class="app-title">JANNAH</h1>
            </div>
            <div class="hasanat-counter">
                <span>‚ú®</span>
                <span class="hasanat-count" id="hasanatCount">0</span>
            </div>
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('test')">
            <span class="nav-tab-icon">üß™</span>
            <span>Test</span>
        </button>
        <button class="nav-tab" onclick="switchTab('quran')">
            <span class="nav-tab-icon">üìñ</span>
            <span>Qur'an</span>
        </button>
        <button class="nav-tab" onclick="switchTab('daily')">
            <span class="nav-tab-icon">üåü</span>
            <span>Daily</span>
        </button>
        <button class="nav-tab" onclick="switchTab('hadith')">
            <span class="nav-tab-icon">üìú</span>
            <span>Hadith</span>
        </button>
        <button class="nav-tab" onclick="switchTab('prophets')">
            <span class="nav-tab-icon">üëë</span>
            <span>Prophets</span>
        </button>
        <button class="nav-tab" onclick="switchTab('dua')">
            <span class="nav-tab-icon">ü§≤</span>
            <span>Du'a</span>
        </button>
        <button class="nav-tab" onclick="switchTab('quotes')">
            <span class="nav-tab-icon">üí´</span>
            <span>Quotes</span>
        </button>
        <button class="nav-tab" onclick="switchTab('prayer')">
            <span class="nav-tab-icon">üïê</span>
            <span>Prayer</span>
        </button>
        <button class="nav-tab" onclick="switchTab('progress')">
            <span class="nav-tab-icon">üìä</span>
            <span>Progress</span>
        </button>
    </div>

    <div class="content-area">
        <!-- Test Tab -->
        <div id="test" class="tab-content active">
            <div class="test-panel">
                <h2 style="margin-bottom: 1rem; font-size: 1.5rem; font-weight: 700;">üß™ System Test Dashboard</h2>
                <p style="margin-bottom: 1.5rem; opacity: 0.9;">Testing all JANNEH features...</p>
                <div id="testResults"></div>
            </div>
            
            <div class="card">
                <h3 class="card-title">
                    <span class="card-icon">üìã</span>
                    Manual Tests
                </h3>
                <div style="display: grid; gap: 1rem;">
                    <button class="btn btn-primary" onclick="testQuranAPI()">Test Qur'an API</button>
                    <button class="btn btn-primary" onclick="testPrayerTracker()">Test Prayer Tracker</button>
                    <button class="btn btn-primary" onclick="testHasanatCounter()">Test Hasanat Counter (+10)</button>
                    <button class="btn btn-primary" onclick="testLocalStorage()">Test localStorage</button>
                    <button class="btn btn-primary" onclick="testPrayerTimesAPI()">Test Prayer Times API (Gambia)</button>
                </div>
            </div>
        </div>

        <!-- Qur'an Tab -->
        <div id="quran" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üìñ</span>
                    Holy Qur'an
                </h2>
                <div class="quran-controls">
                    <select id="surahSelect" class="quran-select" onchange="loadSurah()">
                        <option value="">Select a Surah...</option>
                    </select>
                </div>
                <div id="quranContent">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Select a Surah to begin reading...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Daily Verse Tab -->
        <div id="daily" class="tab-content">
            <div class="daily-verse-card">
                <h2 style="margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 700;">üåü Verse of the Day</h2>
                <div id="dailyVerseContent">
                    <div class="loading" style="color: white;">
                        <div class="spinner" style="border-top-color: white;"></div>
                        <p>Loading today's verse...</p>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">
                    <span class="card-icon">üîî</span>
                    Daily Reminders
                </h3>
                <p style="color: var(--gray); margin-bottom: 1rem;">Get notified with a beautiful verse every day</p>
                <button class="btn btn-primary" onclick="enableNotifications()">Enable Daily Notifications</button>
            </div>
        </div>

        <!-- Hadith Tab -->
        <div id="hadith" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üìú</span>
                    Hadith Collection (20+ Authentic Hadiths)
                </h2>
                <div id="hadithContent"></div>
            </div>
        </div>

        <!-- Prophets Tab -->
        <div id="prophets" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üëë</span>
                    Stories of the Prophets
                </h2>
                <div class="story-grid" id="prophetsGrid"></div>
            </div>
        </div>

        <!-- Du'a Tab -->
        <div id="dua" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">ü§≤</span>
                    Essential Du'as (10+ Supplications)
                </h2>
                <div id="duaContent"></div>
            </div>
        </div>

        <!-- Quotes Tab -->
        <div id="quotes" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üí´</span>
                    Islamic Wisdom & Quotes
                </h2>
                <div id="quotesContent"></div>
            </div>
        </div>

        <!-- Prayer Tracker Tab -->
        <div id="prayer" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üïê</span>
                    Prayer Tracker - Gambia
                </h2>
                <p style="color: var(--gray); margin-bottom: 0.5rem;">Track your daily prayers</p>
                <p id="prayerLocation" style="color: var(--primary-green); font-weight: 600; margin-bottom: 1.5rem;"></p>
                <div class="prayer-grid" id="prayerGrid"></div>
            </div>
        </div>

        <!-- Progress Tab -->
        <div id="progress" class="tab-content">
            <div class="card">
                <h2 class="card-title">
                    <span class="card-icon">üìä</span>
                    Your Progress
                </h2>
                <div id="progressContent"></div>
            </div>
        </div>
    </div>

    <script>
        // App State
        let hasanat = parseInt(localStorage.getItem('hasanat')) || 0;
        let prayerStatus = JSON.parse(localStorage.getItem('prayerStatus')) || {};
        let readingSessions = JSON.parse(localStorage.getItem('readingSessions')) || [];
        let testResults = {
            localStorage: false,
            quranAPI: false,
            prayerAPI: false,
            hasanatCounter: false,
            prayerTracker: false
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateHasanatDisplay();
            loadSurahList();
            loadDailyVerse();
            loadHadith();
            loadProphets();
            loadDuas();
            loadQuotes();
            loadPrayerTracker();
            loadProgress();
            runSystemTests();
        });

        // Tab Switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.closest('.nav-tab').classList.add('active');
        }

        // System Tests
        async function runSystemTests() {
            const container = document.getElementById('testResults');
            
            // Test localStorage
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                testResults.localStorage = value === 'value';
            } catch (e) {
                testResults.localStorage = false;
            }
            
            // Test Qur'an API
            try {
                const response = await fetch('https://api.alquran.cloud/v1/surah/1');
                testResults.quranAPI = response.ok;
            } catch (e) {
                testResults.quranAPI = false;
            }
            
            // Test Prayer Times API
            try {
                const response = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Banjul&country=Gambia');
                testResults.prayerAPI = response.ok;
            } catch (e) {
                testResults.prayerAPI = false;
            }
            
            testResults.hasanatCounter = true; // Always works
            testResults.prayerTracker = testResults.localStorage; // Depends on localStorage
            
            displayTestResults();
        }

        function displayTestResults() {
            const container = document.getElementById('testResults');
            let html = '';
            
            const tests = [
                { name: 'localStorage Support', key: 'localStorage' },
                { name: 'Qur\'an API Connection', key: 'quranAPI' },
                { name: 'Prayer Times API (Gambia)', key: 'prayerAPI' },
                { name: 'Hasanat Counter', key: 'hasanatCounter' },
                { name: 'Prayer Tracker', key: 'prayerTracker' }
            ];
            
            tests.forEach(test => {
                const status = testResults[test.key];
                html += `
                    <div class="test-item">
                        <div class="test-status ${status ? 'success' : 'pending'}">
                            ${status ? '‚úì' : '‚è≥'}
                        </div>
                        <span>${test.name}</span>
                        <span style="margin-left: auto; font-weight: 600;">
                            ${status ? 'PASS' : 'TESTING...'}
                        </span>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Manual Test Functions
        async function testQuranAPI() {
            showNotification('Testing Qur\'an API...');
            try {
                const response = await fetch('https://api.alquran.cloud/v1/surah/1');
                const data = await response.json();
                if (data.data) {
                    showNotification('‚úì Qur\'an API Working! Loaded Al-Fatihah');
                    testResults.quranAPI = true;
                } else {
                    showNotification('‚úó Qur\'an API Error');
                    testResults.quranAPI = false;
                }
            } catch (e) {
                showNotification('‚úó Qur\'an API Connection Failed');
                testResults.quranAPI = false;
            }
            displayTestResults();
        }

        async function testPrayerTimesAPI() {
            showNotification('Testing Prayer Times API for Gambia...');
            try {
                const response = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Banjul&country=Gambia');
                const data = await response.json();
                if (data.data) {
                    const times = data.data.timings;
                    showNotification(`‚úì Prayer Times Loaded! Fajr: ${times.Fajr}, Dhuhr: ${times.Dhuhr}`);
                    testResults.prayerAPI = true;
                } else {
                    showNotification('‚úó Prayer Times API Error');
                    testResults.prayerAPI = false;
                }
            } catch (e) {
                showNotification('‚úó Prayer Times API Connection Failed');
                testResults.prayerAPI = false;
            }
            displayTestResults();
        }

        function testPrayerTracker() {
            const today = new Date().toDateString();
            if (!prayerStatus[today]) prayerStatus[today] = {};
            prayerStatus[today]['Test'] = true;
            localStorage.setItem('prayerStatus', JSON.stringify(prayerStatus));
            
            const saved = JSON.parse(localStorage.getItem('prayerStatus'));
            if (saved[today]['Test']) {
                showNotification('‚úì Prayer Tracker Saving Works!');
                testResults.prayerTracker = true;
            } else {
                showNotification('‚úó Prayer Tracker Save Failed');
                testResults.prayerTracker = false;
            }
            displayTestResults();
        }

        function testHasanatCounter() {
            addHasanat(10, 'Manual Test');
            testResults.hasanatCounter = true;
            displayTestResults();
        }

        function testLocalStorage() {
            try {
                localStorage.setItem('janneh_test', 'working');
                const value = localStorage.getItem('janneh_test');
                localStorage.removeItem('janneh_test');
                if (value === 'working') {
                    showNotification('‚úì localStorage Working Perfectly!');
                    testResults.localStorage = true;
                } else {
                    showNotification('‚úó localStorage Read Failed');
                    testResults.localStorage = false;
                }
            } catch (e) {
                showNotification('‚úó localStorage Not Available: ' + e.message);
                testResults.localStorage = false;
            }
            displayTestResults();
        }

        // Hasanat System
        function addHasanat(amount, reason) {
            hasanat += amount;
            localStorage.setItem('hasanat', hasanat);
            updateHasanatDisplay();
            showNotification(`+${amount} Hasanat! ${reason}`);
        }

        function updateHasanatDisplay() {
            document.getElementById('hasanatCount').textContent = hasanat;
        }

        // Load Surah List
        async function loadSurahList() {
            try {
                const response = await fetch('https://api.alquran.cloud/v1/surah');
                const data = await response.json();
                const select = document.getElementById('surahSelect');
                
                data.data.forEach(surah => {
                    const option = document.createElement('option');
                    option.value = surah.number;
                    option.textContent = `${surah.number}. ${surah.englishName} (${surah.name})`;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error loading surahs:', error);
            }
        }

        // Load Surah Content
        async function loadSurah() {
            const surahNumber = document.getElementById('surahSelect').value;
            if (!surahNumber) return;

            const content = document.getElementById('quranContent');
            content.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading verses...</p></div>';

            try {
                const [arabicRes, translationRes, transliterationRes] = await Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}`),
                    fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/en.asad`),
                    fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}/en.transliteration`)
                ]);

                const arabicData = await arabicRes.json();
                const translationData = await translationRes.json();
                const transliterationData = await transliterationRes.json();

                let html = '';
                arabicData.data.ayahs.forEach((ayah, index) => {
                    html += `
                        <div class="quran-verse">
                            <span class="verse-number">Verse ${ayah.numberInSurah}</span>
                            <div class="arabic-text">${ayah.text}</div>
                            <div class="transliteration">${transliterationData.data.ayahs[index].text}</div>
                            <div class="translation">${translationData.data.ayahs[index].text}</div>
                        </div>
                    `;
                });

                content.innerHTML = html;
                addHasanat(5, 'Reading Qur\'an');
                trackReadingSession(surahNumber);
            } catch (error) {
                content.innerHTML = '<p style="color: var(--gray); text-align: center;">Error loading surah. Please try again.</p>';
                console.error('Error:', error);
            }
        }

        // Daily Verse
        async function loadDailyVerse() {
            try {
                const today = new Date().toDateString();
                const cached = localStorage.getItem('dailyVerse');
                const cachedDate = localStorage.getItem('dailyVerseDate');

                if (cached && cachedDate === today) {
                    displayDailyVerse(JSON.parse(cached));
                    return;
                }

                const randomSurah = Math.floor(Math.random() * 114) + 1;
                const [arabicRes, translationRes] = await Promise.all([
                    fetch(`https://api.alquran.cloud/v1/surah/${randomSurah}`),
                    fetch(`https://api.alquran.cloud/v1/surah/${randomSurah}/en.asad`)
                ]);

                const arabicData = await arabicRes.json();
                const translationData = await translationRes.json();

                const randomVerse = Math.floor(Math.random() * arabicData.data.ayahs.length);
                const verse = {
                    arabic: arabicData.data.ayahs[randomVerse].text,
                    translation: translationData.data.ayahs[randomVerse].text,
                    reference: `${arabicData.data.englishName} ${arabicData.data.ayahs[randomVerse].numberInSurah}`
                };

                localStorage.setItem('dailyVerse', JSON.stringify(verse));
                localStorage.setItem('dailyVerseDate', today);
                displayDailyVerse(verse);
            } catch (error) {
                console.error('Error loading daily verse:', error);
            }
        }

        function displayDailyVerse(verse) {
            document.getElementById('dailyVerseContent').innerHTML = `
                <div class="arabic-text">${verse.arabic}</div>
                <div class="translation">${verse.translation}</div>
                <p style="margin-top: 1.5rem; opacity: 0.9;">${verse.reference}</p>
            `;
        }

        // Hadith - Expanded to 20+
        function loadHadith() {
            const hadiths = [
                { arabic: "ÿ•ŸêŸÜŸéŸëŸÖŸéÿß ÿßŸÑŸíÿ£ŸéÿπŸíŸÖŸéÿßŸÑŸè ÿ®ŸêÿßŸÑŸÜŸêŸëŸäŸéŸëÿßÿ™Ÿê", translation: "Actions are judged by intentions, and every person will be rewarded according to their intention.", reference: "Sahih al-Bukhari 1" },
                { arabic: "ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸè ŸÖŸéŸÜŸí ÿ≥ŸéŸÑŸêŸÖŸé ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸèŸàŸÜŸé ŸÖŸêŸÜŸí ŸÑŸêÿ≥ŸéÿßŸÜŸêŸáŸê ŸàŸéŸäŸéÿØŸêŸáŸê", translation: "A Muslim is one from whose tongue and hands other Muslims are safe.", reference: "Sahih al-Bukhari 10" },
                { arabic: "ŸÖŸéŸÜŸí ŸÉŸéÿßŸÜŸé ŸäŸèÿ§ŸíŸÖŸêŸÜŸè ÿ®ŸêÿßŸÑŸÑŸéŸëŸáŸê ŸàŸéÿßŸÑŸíŸäŸéŸàŸíŸÖŸê ÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿê ŸÅŸéŸÑŸíŸäŸéŸÇŸèŸÑŸí ÿÆŸéŸäŸíÿ±Ÿãÿß ÿ£ŸéŸàŸí ŸÑŸêŸäŸéÿµŸíŸÖŸèÿ™Ÿí", translation: "Whoever believes in Allah and the Last Day should speak good or remain silent.", reference: "Sahih al-Bukhari 6018" },
                { arabic: "ŸÑŸéÿß ŸäŸèÿ§ŸíŸÖŸêŸÜŸè ÿ£Ÿéÿ≠ŸéÿØŸèŸÉŸèŸÖŸí ÿ≠Ÿéÿ™ŸéŸëŸâ ŸäŸèÿ≠Ÿêÿ®ŸéŸë ŸÑŸêÿ£ŸéÿÆŸêŸäŸáŸê ŸÖŸéÿß ŸäŸèÿ≠Ÿêÿ®ŸèŸë ŸÑŸêŸÜŸéŸÅŸíÿ≥ŸêŸáŸê", translation: "None of you truly believes until he loves for his brother what he loves for himself.", reference: "Sahih al-Bukhari 13" },
                { arabic: "ÿßŸÑÿØŸêŸëŸäŸÜŸè ÿßŸÑŸÜŸéŸëÿµŸêŸäÿ≠Ÿéÿ©Ÿè", translation: "Religion is sincerity and sincere advice.", reference: "Sahih Muslim 55" },
                { arabic: "ŸÖŸéŸÜŸí ŸäŸèÿ±ŸêÿØŸê ÿßŸÑŸÑŸéŸëŸáŸè ÿ®ŸêŸáŸê ÿÆŸéŸäŸíÿ±Ÿãÿß ŸäŸèŸÅŸéŸÇŸêŸëŸáŸíŸáŸè ŸÅŸêŸä ÿßŸÑÿØŸêŸëŸäŸÜŸê", translation: "If Allah wants good for someone, He gives him understanding of the religion.", reference: "Sahih al-Bukhari 71" },
                { arabic: "ÿ™Ÿéÿ®Ÿéÿ≥ŸèŸëŸÖŸèŸÉŸé ŸÅŸêŸä ŸàŸéÿ¨ŸíŸáŸê ÿ£ŸéÿÆŸêŸäŸÉŸé ÿµŸéÿØŸéŸÇŸéÿ©Ÿå", translation: "Smiling in your brother's face is an act of charity.", reference: "Jami at-Tirmidhi 1956" },
                { arabic: "ÿÆŸéŸäŸíÿ±ŸèŸÉŸèŸÖŸí ÿÆŸéŸäŸíÿ±ŸèŸÉŸèŸÖŸí ŸÑŸêÿ£ŸéŸáŸíŸÑŸêŸáŸê", translation: "The best of you are those who are best to their families.", reference: "Jami at-Tirmidhi 3895" },
                { arabic: "ÿßŸÑÿ∑ŸèŸëŸáŸèŸàÿ±Ÿè ÿ¥Ÿéÿ∑Ÿíÿ±Ÿè ÿßŸÑÿ•ŸêŸäŸÖŸéÿßŸÜŸê", translation: "Cleanliness is half of faith.", reference: "Sahih Muslim 223" },
                { arabic: "ÿßÿ™ŸéŸëŸÇŸê ÿßŸÑŸÑŸéŸëŸáŸé ÿ≠ŸéŸäŸíÿ´ŸèŸÖŸéÿß ŸÉŸèŸÜŸíÿ™Ÿé", translation: "Fear Allah wherever you are.", reference: "Jami at-Tirmidhi 1987" },
                { arabic: "ÿßŸÑŸíŸÉŸéŸÑŸêŸÖŸéÿ©Ÿè ÿßŸÑÿ∑ŸéŸëŸäŸêŸëÿ®Ÿéÿ©Ÿè ÿµŸéÿØŸéŸÇŸéÿ©Ÿå", translation: "A kind word is a form of charity.", reference: "Sahih al-Bukhari 2989" },
                { arabic: "ÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸè ÿßŸÑŸíŸÇŸéŸàŸêŸäŸèŸë ÿÆŸéŸäŸíÿ±Ÿå ŸàŸéÿ£Ÿéÿ≠Ÿéÿ®ŸèŸë ÿ•ŸêŸÑŸéŸâ ÿßŸÑŸÑŸéŸëŸáŸê ŸÖŸêŸÜŸé ÿßŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸê ÿßŸÑÿ∂ŸéŸëÿπŸêŸäŸÅŸê", translation: "The strong believer is better and more beloved to Allah than the weak believer.", reference: "Sahih Muslim 2664" },
                { arabic: "ŸÖŸéŸÜŸí ÿµŸéŸÑŸéŸëŸâ ÿßŸÑŸíŸÅŸéÿ¨Ÿíÿ±Ÿé ŸÅŸéŸáŸèŸàŸé ŸÅŸêŸä ÿ∞ŸêŸÖŸéŸëÿ©Ÿê ÿßŸÑŸÑŸéŸëŸáŸê", translation: "Whoever prays Fajr is under Allah's protection.", reference: "Sahih Muslim 657" },
                { arabic: "ÿÆŸéŸäŸíÿ±Ÿè ÿßŸÑÿ≤ŸéŸëÿßÿØŸê ÿßŸÑÿ™ŸéŸëŸÇŸíŸàŸéŸâ", translation: "The best provision is piety.", reference: "Quran 2:197" },
                { arabic: "ÿßŸÑÿµŸéŸëŸÑŸéÿßÿ©Ÿè ŸÜŸèŸàÿ±Ÿå", translation: "Prayer is light.", reference: "Sahih Muslim 223" },
                { arabic: "ŸÖŸéŸÜŸí ÿµŸéÿßŸÖŸé ÿ±ŸéŸÖŸéÿ∂ŸéÿßŸÜŸé ÿ•ŸêŸäŸÖŸéÿßŸÜŸãÿß ŸàŸéÿßÿ≠Ÿíÿ™Ÿêÿ≥Ÿéÿßÿ®Ÿãÿß ÿ∫ŸèŸÅŸêÿ±Ÿé ŸÑŸéŸáŸè ŸÖŸéÿß ÿ™ŸéŸÇŸéÿØŸéŸëŸÖŸé ŸÖŸêŸÜŸí ÿ∞ŸéŸÜŸíÿ®ŸêŸáŸê", translation: "Whoever fasts Ramadan with faith and seeking reward, his past sins will be forgiven.", reference: "Sahih al-Bukhari 38" },
                { arabic: "ÿßŸÑŸíÿ¨ŸéŸÜŸéŸëÿ©Ÿè ÿ™Ÿéÿ≠Ÿíÿ™Ÿé ÿ£ŸéŸÇŸíÿØŸéÿßŸÖŸê ÿßŸÑÿ£ŸèŸÖŸéŸëŸáŸéÿßÿ™Ÿê", translation: "Paradise lies at the feet of mothers.", reference: "Sunan an-Nasa'i 3104" },
                { arabic: "ŸÖŸéŸÜŸí ÿ∫Ÿéÿ¥ŸéŸëŸÜŸéÿß ŸÅŸéŸÑŸéŸäŸíÿ≥Ÿé ŸÖŸêŸÜŸéŸëÿß", translation: "Whoever cheats us is not one of us.", reference: "Sahih Muslim 101" },
                { arabic: "ÿ™Ÿéÿ±ŸíŸÉŸè ÿßŸÑŸíŸÖŸéÿπŸéÿßÿµŸêŸä ÿ£ŸéŸäŸíÿ≥Ÿéÿ±Ÿè ŸÖŸêŸÜŸí ÿ∑ŸéŸÑŸéÿ®Ÿê ÿßŸÑÿ™ŸéŸëŸàŸíÿ®Ÿéÿ©Ÿê", translation: "Avoiding sins is easier than seeking repentance.", reference: "Islamic Wisdom" },
                { arabic: "ÿ≠ŸéŸÇŸèŸë ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸê ÿπŸéŸÑŸéŸâ ÿßŸÑŸíŸÖŸèÿ≥ŸíŸÑŸêŸÖŸê ÿÆŸéŸÖŸíÿ≥Ÿå", translation: "The rights of a Muslim upon another Muslim are five: returning greetings, visiting the sick, following funerals, accepting invitations, and saying 'yarhamuk Allah' when someone sneezes.", reference: "Sahih al-Bukhari 1240" }
            ];

            let html = '';
            hadiths.forEach(hadith => {
                html += `
                    <div class="hadith-item">
                        <div class="hadith-arabic">${hadith.arabic}</div>
                        <div class="hadith-translation">${hadith.translation}</div>
                        <div class="hadith-reference">${hadith.reference}</div>
                    </div>
                `;
            });

            document.getElementById('hadithContent').innerHTML = html;
        }

        // Prophets - Expanded
        function loadProphets() {
            const prophets = [
                { name: "Prophet Adam (AS)", preview: "The first human and prophet, created by Allah from clay and placed in Paradise. He was taught the names of all things and was honored by the angels." },
                { name: "Prophet Nuh (AS)", preview: "Preached for 950 years calling his people to monotheism. Built the ark by Allah's command and saved believers from the great flood that destroyed the disbelievers." },
                { name: "Prophet Ibrahim (AS)", preview: "The Friend of Allah (Khalilullah), father of the prophets. He smashed idols, survived being thrown into fire, and was tested with sacrificing his son Ismail." },
                { name: "Prophet Ismail (AS)", preview: "Son of Ibrahim, showed complete submission when asked to be sacrificed. Allah replaced him with a ram and he helped his father build the Ka'bah." },
                { name: "Prophet Ishaq (AS)", preview: "Son of Ibrahim and Sarah, born when his parents were very old. He continued his father's mission and was blessed with the prophet Ya'qub." },
                { name: "Prophet Ya'qub (AS)", preview: "Also known as Israel, father of 12 sons who became the tribes of Israel. Showed patience when his beloved son Yusuf was lost." },
                { name: "Prophet Yusuf (AS)", preview: "Known for his exceptional beauty and righteousness. Thrown into a well by his brothers, sold as a slave, falsely imprisoned, but eventually became the minister of Egypt through Allah's plan." },
                { name: "Prophet Musa (AS)", preview: "Spoke directly with Allah (Kalimullah). Born during Pharaoh's tyranny, grew in Pharaoh's palace, performed miracles with his staff, parted the Red Sea, and received the Torah." },
                { name: "Prophet Harun (AS)", preview: "Brother of Musa and his helper in delivering the message to Pharaoh. Known for his eloquence and supported Musa throughout his mission." },
                { name: "Prophet Dawud (AS)", preview: "Given the Psalms (Zabur), had a beautiful voice in worship. Slayed Goliath as a youth and became a just king. Iron would soften in his hands." },
                { name: "Prophet Sulaiman (AS)", preview: "Son of Dawud, given wisdom, power over jinn and animals, and control of the wind. Built great structures and understood the speech of birds and ants." },
                { name: "Prophet Yunus (AS)", preview: "Left his people in anger before Allah commanded. Was swallowed by a whale, made sincere repentance in its belly, and was saved by Allah's mercy." },
                { name: "Prophet Ayyub (AS)", preview: "A wealthy man tested with loss of family, health, and wealth. Showed immense patience and never complained. Allah restored everything he lost and more." },
                { name: "Prophet Zakariya (AS)", preview: "A devout worshipper who was blessed with Prophet Yahya in his old age after making sincere du'a. He was a guardian of Maryam." },
                { name: "Prophet Yahya (AS)", preview: "Born to elderly parents as a miracle. Known for his piety from childhood, called people to worship Allah alone, and was honored with wisdom while still young." },
                { name: "Prophet Isa (AS)", preview: "Born miraculously to Virgin Maryam without a father. Performed miracles by Allah's permission: healed the sick, gave life to the dead, created birds from clay. He was not crucified but raised to heaven." },
                { name: "Prophet Muhammad (SAW)", preview: "The final messenger and seal of the prophets, sent as a mercy to all mankind. Received the Qur'an, completed the message of Islam, exemplified the best character, and showed us how to worship Allah." }
            ];

            let html = '';
            prophets.forEach(prophet => {
                html += `
                    <div class="story-card" onclick="addHasanat(3, 'Learning about Prophets')">
                        <div class="story-title">${prophet.name}</div>
                        <div class="story-preview">${prophet.preview}</div>
                    </div>
                `;
            });

            document.getElementById('prophetsGrid').innerHTML = html;
        }

        // Du'as - Expanded to 10+
        function loadDuas() {
            const duas = [
                { arabic: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ÿ¢ÿ™ŸêŸÜŸéÿß ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÅŸêŸä ÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê ÿ≠Ÿéÿ≥ŸéŸÜŸéÿ©Ÿã ŸàŸéŸÇŸêŸÜŸéÿß ÿπŸéÿ∞Ÿéÿßÿ®Ÿé ÿßŸÑŸÜŸéŸëÿßÿ±Ÿê", transliteration: "Rabbana atina fid-dunya hasanatan wa fil-akhirati hasanatan waqina azaban-nar", translation: "Our Lord, give us good in this world and good in the Hereafter, and protect us from the punishment of the Fire." },
                { arabic: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ¥Ÿíÿ±Ÿéÿ≠Ÿí ŸÑŸêŸä ÿµŸéÿØŸíÿ±ŸêŸä ŸàŸéŸäŸéÿ≥ŸêŸëÿ±Ÿí ŸÑŸêŸä ÿ£ŸéŸÖŸíÿ±ŸêŸä", transliteration: "Rabbi ishrah li sadri wa yassir li amri", translation: "My Lord, expand for me my breast and ease for me my task." },
                { arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíŸáŸèÿØŸéŸâ ŸàŸéÿßŸÑÿ™ŸèŸëŸÇŸéŸâ ŸàŸéÿßŸÑŸíÿπŸéŸÅŸéÿßŸÅŸé ŸàŸéÿßŸÑŸíÿ∫ŸêŸÜŸéŸâ", transliteration: "Allahumma inni as'aluka al-huda wat-tuqa wal-'afafa wal-ghina", translation: "O Allah, I ask You for guidance, piety, chastity and contentment." },
                { arabic: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸÑŸéÿß ÿ™Ÿèÿ≤Ÿêÿ∫Ÿí ŸÇŸèŸÑŸèŸàÿ®ŸéŸÜŸéÿß ÿ®ŸéÿπŸíÿØŸé ÿ•Ÿêÿ∞Ÿí ŸáŸéÿØŸéŸäŸíÿ™ŸéŸÜŸéÿß ŸàŸéŸáŸéÿ®Ÿí ŸÑŸéŸÜŸéÿß ŸÖŸêŸÜ ŸÑŸéŸëÿØŸèŸÜŸÉŸé ÿ±Ÿéÿ≠ŸíŸÖŸéÿ©Ÿã", transliteration: "Rabbana la tuzigh quloobana ba'da idh hadaytana wa hab lana min ladunka rahmah", translation: "Our Lord, let not our hearts deviate after You have guided us and grant us from Yourself mercy." },
                { arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£ŸéÿπŸèŸàÿ∞Ÿè ÿ®ŸêŸÉŸé ŸÖŸêŸÜŸé ÿßŸÑŸíŸáŸéŸÖŸêŸë ŸàŸéÿßŸÑŸíÿ≠Ÿéÿ≤ŸéŸÜŸê", transliteration: "Allahumma inni a'udhu bika minal-hammi wal-hazan", translation: "O Allah, I seek refuge in You from worry and grief." },
                { arabic: "ÿ±Ÿéÿ®ŸêŸë ÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä ŸàŸéŸÑŸêŸàŸéÿßŸÑŸêÿØŸéŸäŸéŸë", transliteration: "Rabbighfir li wa li-walidayya", translation: "My Lord, forgive me and my parents." },
                { arabic: "ÿ≠Ÿéÿ≥Ÿíÿ®ŸèŸÜŸéÿß ÿßŸÑŸÑŸéŸëŸáŸè ŸàŸéŸÜŸêÿπŸíŸÖŸé ÿßŸÑŸíŸàŸéŸÉŸêŸäŸÑŸè", transliteration: "Hasbunallahu wa ni'mal wakeel", translation: "Sufficient for us is Allah, and He is the best Disposer of affairs." },
                { arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿßŸÑŸíÿπŸéÿßŸÅŸêŸäŸéÿ©Ÿé ŸÅŸêŸä ÿßŸÑÿØŸèŸëŸÜŸíŸäŸéÿß ŸàŸéÿßŸÑŸíÿ¢ÿÆŸêÿ±Ÿéÿ©Ÿê", transliteration: "Allahumma inni as'alukal-'afiyah fid-dunya wal-akhirah", translation: "O Allah, I ask You for well-being in this world and the Hereafter." },
                { arabic: "ÿ±Ÿéÿ®ŸéŸëŸÜŸéÿß ŸáŸéÿ®Ÿí ŸÑŸéŸÜŸéÿß ŸÖŸêŸÜŸí ÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨ŸêŸÜŸéÿß ŸàŸéÿ∞Ÿèÿ±ŸêŸëŸäŸéŸëÿßÿ™ŸêŸÜŸéÿß ŸÇŸèÿ±ŸéŸëÿ©Ÿé ÿ£ŸéÿπŸíŸäŸèŸÜŸç", transliteration: "Rabbana hab lana min azwajina wa dhurriyyatina qurrata a'yun", translation: "Our Lord, grant us from among our wives and offspring comfort to our eyes." },
                { arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ£Ÿéÿ≥Ÿíÿ£ŸéŸÑŸèŸÉŸé ÿπŸêŸÑŸíŸÖŸãÿß ŸÜŸéÿßŸÅŸêÿπŸãÿß", transliteration: "Allahumma inni as'aluka 'ilman nafi'a", translation: "O Allah, I ask You for beneficial knowledge." },
                { arabic: "ÿ±Ÿéÿ®ŸêŸë ÿ≤ŸêÿØŸíŸÜŸêŸä ÿπŸêŸÑŸíŸÖŸãÿß", transliteration: "Rabbi zidni 'ilma", translation: "My Lord, increase me in knowledge." },
                { arabic: "ÿßŸÑŸÑŸéŸëŸáŸèŸÖŸéŸë ÿ•ŸêŸÜŸêŸëŸä ÿ∏ŸéŸÑŸéŸÖŸíÿ™Ÿè ŸÜŸéŸÅŸíÿ≥ŸêŸä ÿ∏ŸèŸÑŸíŸÖŸãÿß ŸÉŸéÿ´ŸêŸäÿ±Ÿãÿß ŸÅŸéÿßÿ∫ŸíŸÅŸêÿ±Ÿí ŸÑŸêŸä", transliteration: "Allahumma inni zalamtu nafsi zulman katheeran faghfir li", translation: "O Allah, I have greatly wronged myself, so forgive me." }
            ];

            let html = '';
            duas.forEach(dua => {
                html += `
                    <div class="dua-item">
                        <div class="dua-arabic">${dua.arabic}</div>
                        <div class="dua-transliteration">${dua.transliteration}</div>
                        <div class="dua-translation">${dua.translation}</div>
                    </div>
                `;
            });

            document.getElementById('duaContent').innerHTML = html;
        }

        // Quotes
        function loadQuotes() {
            const quotes = [
                { text: "The best among you are those who have the best manners and character.", author: "Prophet Muhammad (SAW)" },
                { text: "Do not lose hope, nor be sad.", author: "Qur'an 3:139" },
                { text: "Allah does not burden a soul beyond that it can bear.", author: "Qur'an 2:286" },
                { text: "Verily, with hardship comes ease.", author: "Qur'an 94:6" },
                { text: "The believer's shade on the Day of Resurrection will be his charity.", author: "Prophet Muhammad (SAW)" },
                { text: "Kindness is a mark of faith, and whoever is not kind has no faith.", author: "Prophet Muhammad (SAW)" },
                { text: "The strong person is not the one who can wrestle, but the one who controls himself when angry.", author: "Prophet Muhammad (SAW)" },
                { text: "Make things easy and do not make them difficult, cheer people up and do not repel them.", author: "Prophet Muhammad (SAW)" },
                { text: "A good word is charity.", author: "Prophet Muhammad (SAW)" },
                { text: "And whoever relies upon Allah - then He is sufficient for him.", author: "Qur'an 65:3" }
            ];

            let html = '';
            quotes.forEach(quote => {
                html += `
                    <div class="quote-card">
                        <div class="quote-text">"${quote.text}"</div>
                        <div class="quote-author">‚Äî ${quote.author}</div>
                    </div>
                `;
            });

            document.getElementById('quotesContent').innerHTML = html;
        }

        // Prayer Tracker with Gambia Times
        async function loadPrayerTracker() {
            const today = new Date().toDateString();
            if (!prayerStatus[today]) {
                prayerStatus[today] = {};
            }

            document.getElementById('prayerLocation').textContent = 'üìç Banjul, Gambia';

            try {
                const response = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Banjul&country=Gambia');
                const data = await response.json();
                
                if (data.data && data.data.timings) {
                    const times = data.data.timings;
                    const prayers = [
                        { name: 'Fajr', time: times.Fajr },
                        { name: 'Dhuhr', time: times.Dhuhr },
                        { name: 'Asr', time: times.Asr },
                        { name: 'Maghrib', time: times.Maghrib },
                        { name: 'Isha', time: times.Isha }
                    ];

                    let html = '';
                    prayers.forEach(prayer => {
                        const completed = prayerStatus[today][prayer.name] || false;
                        html += `
                            <div class="prayer-item ${completed ? 'completed' : ''}" onclick="togglePrayer('${prayer.name}')">
                                <div class="prayer-name">${prayer.name}</div>
                                <div class="prayer-time">${prayer.time}</div>
                                ${completed ? '<div style="margin-top: 0.5rem; font-size: 1.5rem;">‚úì</div>' : ''}
                            </div>
                        `;
                    });

                    document.getElementById('prayerGrid').innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading prayer times:', error);
                // Fallback to default times if API fails
                const prayers = [
                    { name: 'Fajr', time: '05:30' },
                    { name: 'Dhuhr', time: '13:00' },
                    { name: 'Asr', time: '16:15' },
                    { name: 'Maghrib', time: '18:45' },
                    { name: 'Isha', time: '20:00' }
                ];

                let html = '';
                prayers.forEach(prayer => {
                    const completed = prayerStatus[today][prayer.name] || false;
                    html += `
                        <div class="prayer-item ${completed ? 'completed' : ''}" onclick="togglePrayer('${prayer.name}')">
                            <div class="prayer-name">${prayer.name}</div>
                            <div class="prayer-time">${prayer.time}</div>
                            ${completed ? '<div style="margin-top: 0.5rem; font-size: 1.5rem;">‚úì</div>' : ''}
                        </div>
                    `;
                });

                document.getElementById('prayerGrid').innerHTML = html;
            }
        }

        function togglePrayer(prayerName) {
            const today = new Date().toDateString();
            if (!prayerStatus[today]) {
                prayerStatus[today] = {};
            }

            prayerStatus[today][prayerName] = !prayerStatus[today][prayerName];
            localStorage.setItem('prayerStatus', JSON.stringify(prayerStatus));

            if (prayerStatus[today][prayerName]) {
                addHasanat(10, `Completed ${prayerName} prayer`);
            } else {
                hasanat -= 10;
                localStorage.setItem('hasanat', hasanat);
                updateHasanatDisplay();
            }

            loadPrayerTracker();
        }

        // Progress
        function loadProgress() {
            const completedPrayers = Object.values(prayerStatus).reduce((total, day) => {
                return total + Object.values(day).filter(v => v).length;
            }, 0);

            const html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div style="background: linear-gradient(135deg, var(--primary-green), var(--dark-green)); color: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: var(--shadow-lg);">
                        <div style="font-size: 3.5rem; font-weight: 800; margin-bottom: 0.5rem;">${hasanat}</div>
                        <div style="font-size: 1.1rem; font-weight: 600;">Total Hasanat</div>
                    </div>
                    <div style="background: linear-gradient(135deg, var(--gold), #ea580c); color: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: var(--shadow-lg);">
                        <div style="font-size: 3.5rem; font-weight: 800; margin-bottom: 0.5rem;">${completedPrayers}</div>
                        <div style="font-size: 1.1rem; font-weight: 600;">Prayers Completed</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; padding: 2rem; border-radius: 12px; text-align: center; box-shadow: var(--shadow-lg);">
                        <div style="font-size: 3.5rem; font-weight: 800; margin-bottom: 0.5rem;">${readingSessions.length}</div>
                        <div style="font-size: 1.1rem; font-weight: 600;">Reading Sessions</div>
                    </div>
                </div>
                <div style="margin-top: 2rem; background: white; padding: 2rem; border-radius: 12px; box-shadow: var(--shadow);">
                    <h3 style="color: var(--dark-green); margin-bottom: 1rem; font-weight: 700;">üéØ Keep Going!</h3>
                    <p style="color: var(--gray); line-height: 1.8;">
                        You're doing amazing! Continue your journey of faith and knowledge. 
                        Every verse you read, every prayer you complete, and every good deed brings you closer to Allah.
                        May Allah accept all your efforts and bless you abundantly!
                    </p>
                </div>
            `;

            document.getElementById('progressContent').innerHTML = html;
        }

        function trackReadingSession(surahNumber) {
            readingSessions.push({
                surah: surahNumber,
                date: new Date().toISOString()
            });
            localStorage.setItem('readingSessions', JSON.stringify(readingSessions));
        }

        // Notifications
        function enableNotifications() {
            if ('Notification' in window) {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        showNotification('Daily notifications enabled! You\'ll receive a beautiful verse every day.');
                        addHasanat(5, 'Enabling daily reminders');
                    }
                });
            } else {
                showNotification('Your browser doesn\'t support notifications, but you can still enjoy all the content!');
            }
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        @keyframes slideOut {
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        // PWA Installation
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.className = 'btn btn-primary';
        installButton.style.cssText = 'position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: none; box-shadow: 0 4px 12px rgba(0,0,0,0.15);';
        installButton.innerHTML = 'üì± Install JANNAH App';
        document.body.appendChild(installButton);

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
        });

        installButton.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                showNotification('üéâ JANNAH installed successfully!');
            }
            deferredPrompt = null;
            installButton.style.display = 'none';
        });

        window.addEventListener('appinstalled', () => {
            showNotification('‚úÖ JANNAH is now installed on your device!');
            installButton.style.display = 'none';
        });

        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('JANNEH: Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    showNotification('üîÑ New version available! Refresh to update.');
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('JANNEH: Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>